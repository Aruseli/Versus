## Заметки по временной авторизации и маршрутам

Этот файл для бэкенд‑разработчика, который будет подключать реальную авторизацию.

### Текущее поведение (фиктивная авторизация)

- Публичный layout: `app/layout.tsx`
  - Оборачивает всё приложение, **без** `BottomNav`.
  - Используется для сплеша и экрана авторизации.

- Стартовая страница: `app/page.tsx` (маршрут `/`)
  - Клиентский компонент с простым state‑машином:
    - `appState = 'splash'` → рендерит `SplashScreen` (`screens/SplashScreen.tsx`), по таймеру вызывает `onFinish`.
    - после `onFinish` → `appState = 'auth'` → рендерит `AuthScreen` (`screens/AuthScreen.tsx`).
  - `AuthScreen` принимает проп `onAuthenticated: () => void` и при нажатии на кнопку **Continue** или **Google** просто вызывает этот колбэк **без реальной проверки**.
  - В `app/page.tsx` внутри `handleAuthenticated` сейчас делается навигация:
    - `router.push('/home')` (или `/` → см. актуальное состояние кода) в авторизованную часть приложения.

- Авторизованный layout: `app/(auth)/layout.tsx`
  - Оборачивает все авторизованные страницы и добавляет `BottomNav`.
  - Группа `(auth)` — **route group**, не добавляет сегмент в URL, а только группирует файлы и задаёт общий layout.

- Авторизованные страницы (часть приложения «после входа»):
  - `app/(auth)/page.tsx` или `app/(auth)/home/page.tsx` — домашний экран (`HomeScreen`).
  - `app/(auth)/battle/[id]/page.tsx` — детали баттла.
  - `app/(auth)/ranking/page.tsx` — рейтинг.
  - `app/(auth)/notifications/page.tsx` — уведомления.
  - `app/(auth)/profile/page.tsx` — профиль.

### Что важно учесть при внедрении реальной авторизации

1. **Разделение публичной и приватной зон уже есть**
   - Публичная зона: корневой `layout` + `app/page.tsx` (сплеш + логин).
   - Приватная зона: `app/(auth)/layout.tsx` + страницы внутри `(auth)`.
   - Сейчас доступ в приватную зону контролируется **чисто на клиенте** через фиктивный `onAuthenticated`.

2. **План на реальную авторизацию**
   - Вместо фиктивного вызова `onAuthenticated()` нужно:
     - либо дергать реальный API‑метод логина (получение токена/сессии),
     - либо интегрировать готовое решение (например, NextAuth/Auth0/собственный JWT).
   - После успешной авторизации:
     - сохранить состояние авторизованности (cookie / httpOnly cookie + session / accessToken в памяти и т.п.),
     - перенаправить пользователя в приватный маршрут (например, `/home` или `/`).

3. **Что делать с временным роутом `/home`**
   - Сейчас `/home` (или `/(auth)/page.tsx`) используется как **домашняя страница авторизованного пользователя**, чтобы не смешивать её с публичным `/`.
   - Когда будет реальная авторизация:
     - можно сделать, чтобы:
       - неавторизованный пользователь на `/` всегда видел только `AuthScreen`,
       - авторизованный пользователь на `/` сразу видел `HomeScreen`.
     - тогда временный `/home` можно:
       - либо удалить,
       - либо оставить как алиас/редирект.

4. **Где удобнее вставить реальную проверку авторизации**
   Варианты (на выбор бэкенд/фулстек‑разработчика):

   - **Middleware + серверные проверki**
     - Next.js middleware читает cookie/токен:
       - если пользователь не авторизован и идёт на маршрут из `(auth)` → редирект на `/` (логин).
       - если авторизован и идёт на `/` → можно редиректить на `/home` или сразу рендерить «домашний» экран.

   - **Клиентский провайдер состояния**
     - Контекст/стор (например, React Context/Zustand), который хранит auth‑состояние.
     - `AuthScreen` по результату логина обновляет этот стор.
     - Авторизованные компоненты/layout читают этот стор и:
       - либо рендерят контент,
       - либо показывают редирект/скелетон/экран логина.

5. **Важно: не забыть убрать фиктивную авторизацию**
   - В `screens/AuthScreen.tsx` сейчас:
     - `handleSendCode` и `handleVerify` делают `setTimeout` и сразу вызывают `onAuthenticated()` без проверки.
   - При реальной авторизации:
     - эта логика должна быть заменена реальными запросами/проверками.

### Кратко для TL;DR

- Публичный `/` сейчас: Splash → фиктивный Auth.
- Авторизованная часть живёт под `(auth)` layout с `BottomNav`.
- Временный маршрут (например, `/home`) нужен только до появления реальной авторизации.
- После внедрения настоящего login‑flow:
  - публичный `/` можно оставить только как Auth (для неавторизованных),
  - а для авторизованных `/` или `/home` станет основной точкой входа в приложение,
  - фиктивные вызовы `onAuthenticated()` нужно заменить на реальный login.


